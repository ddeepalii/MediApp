<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

<div class="hospital-container">
  <div class="animated-background">
    <div class="circle circle-1"></div>
    <div class="circle circle-2"></div>
    <div class="circle circle-3"></div>
  </div>

  <div class="content-wrapper">
    <!-- Page Title -->
    <div class="page-header">
      <h2 class="main-title">
        <i class="fas fa-hospital-alt title-icon"></i>
        Hospital Management System
      </h2>
      <div class="title-underline"></div>
    </div>

    <!-- Add Hospital Card -->
    <div class="glass-card add-hospital-card">
      <div class="card-header-custom">
        <i class="fas fa-plus-circle"></i>
        <span>Add New Hospital</span>
      </div>
      <div class="card-body-custom">
        <!-- <form [formGroup]="itemForm" (ngSubmit)="onSubmit()" class="hospital-form">
          
          <div class="form-group-custom">
            <label class="form-label-custom">
              <i class="fas fa-hospital"></i>
              Hospital Name
            </label>
            <div class="input-wrapper">
              <input 
                formControlName="name" 
                type="text" 
                class="form-input-custom" 
                placeholder="Enter Hospital Name" 
              />
              <span class="input-border"></span>
            </div>
            <div 
              *ngIf="itemForm.get('name')?.invalid && (itemForm.get('name')?.dirty || itemForm.get('name')?.touched)"
              class="error-message">
              <i class="fas fa-exclamation-circle"></i>
              Please enter hospital name
            </div>
          </div>

          <div class="form-group-custom">
            <label class="form-label-custom">
              <i class="fas fa-map-marker-alt"></i>
              Hospital Location
            </label>
            <div class="input-wrapper">
              <input 
                formControlName="location" 
                type="text" 
                class="form-input-custom" 
                placeholder="Enter Hospital Location" 
              />
              <span class="input-border"></span>
            </div>
            <div
              *ngIf="itemForm.get('location')?.invalid && (itemForm.get('location')?.dirty || itemForm.get('location')?.touched)"
              class="error-message">
              <i class="fas fa-exclamation-circle"></i>
              Please enter hospital location
            </div>
          </div>

          <button class="btn-submit" [disabled]="itemForm.invalid">
            <span class="btn-text">{{ editingHospitalId ? 'Update Hospital' : 'Add Hospital' }}</span>
            <i class="fas fa-arrow-right btn-icon"></i>
          </button>

          <div *ngIf="showMessage" class="alert-custom alert-success">
            <i class="fas fa-check-circle"></i>
            {{ responseMessage }}
          </div>
          <div *ngIf="showError" class="alert-custom alert-error">
            <i class="fas fa-times-circle"></i>
            {{ errorMessage }}
          </div>

        </form> -->
        <div class="card-body-custom" style="display: flex; justify-content: center;">
          <button class="btn-submit" type="button" data-bs-toggle="modal" data-bs-target="#addHospitalModal">
            <span class="btn-text">{{ editingHospitalId ? 'Update Hospital' : 'Add New Hospital' }}</span>
            <i class="fas fa-arrow-right btn-icon"></i>
          </button>
        </div>
      </div>

      <!-- Search Section -->
      <div class="search-section">
        <div class="search-wrapper">
          <i class="fas fa-search search-icon"></i>
          <input type="text" class="search-input" placeholder="Search by Hospital Name, Location, or ID"
            [(ngModel)]="modalSearchQuery" (keyup.enter)="filterHospital()" />
          <button class="btn-search" type="button" (click)="filterHospital()">
            <i class="fas fa-search"></i>
            Search
          </button>
          <button class="btn-clear" type="button" (click)="closeIt()">
            <i class="fas fa-times"></i>
            Clear
          </button>
        </div>

        <!-- Status Messages -->
        <div *ngIf="isClick !== true" class="search-alert alert-warning">
          <i class="fas fa-info-circle"></i>
          {{ NotFoundMessage }}
        </div>
        <div *ngIf="isClick === true && showHospitalfilterData" class="search-alert alert-success">
          <i class="fas fa-check-circle"></i>
          {{ FoundMessage }}
        </div>
      </div>

      <!-- Hospital Card Grid Display -->
      <div class="glass-card hospital-list-card" *ngIf="showHospitalData">
        <div class="card-header-custom">
          <i class="fas fa-hospital-user"></i>
          <span>All Hospitals</span>
        </div>
        <div class="card-body-custom">
          <div class="hospital-grid">
            <div class="hospital-item" *ngFor="let hospital of paginatedHospitals; let i = index"
              [style.animation-delay]="i * 0.1 + 's'">
              <div class="hospital-card">
                <div class="hospital-card-header">
                  <div class="hospital-icon-wrapper">
                    <i class="fas fa-hospital"></i>
                  </div>
                  <h5 class="hospital-name">{{ hospital.name }}</h5>
                </div>

                <div class="hospital-details">
                  <div class="detail-item">
                    <i class="fas fa-map-marker-alt detail-icon"></i>
                    <div class="detail-content">
                      <span class="detail-label">Location</span>
                      <span class="detail-value">{{ hospital.location }}</span>
                    </div>
                  </div>

                  <div class="detail-item">
                    <i class="fas fa-id-badge detail-icon"></i>
                    <div class="detail-content">
                      <span class="detail-label">Hospital ID</span>
                      <span class="detail-value">{{ hospital.id }}</span>
                    </div>
                  </div>
                </div>

                <div class="hospital-actions">
                  <button class="action-btn btn-equipment" (click)="Addequipment(hospital)" data-bs-toggle="modal"
                    data-bs-target="#driverModal">
                    <i class="fas fa-tools"></i>
                    <span>Equipment</span>
                  </button>
                  <button class="action-btn btn-edit" (click)="editHospital(hospital)" data-bs-toggle="modal"
                    data-bs-target="#editHospitalModal">
                    <i class="fas fa-pencil-alt"></i>
                    <span>Edit</span>
                  </button>
                  <button class="action-btn btn-delete" (click)="deleteHospital(hospital.id)">
                    <i class="fas fa-trash-alt"></i>
                    <span>Delete</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Pagination Controls -->
      <div class="pagination-wrapper" *ngIf="totalPages > 1">
        <button class="pagination-btn" (click)="prevPage()" [disabled]="currentPage === 1">
          &laquo; Prev
        </button>

        <button class="pagination-btn" *ngFor="let page of [].constructor(totalPages); let i = index"
          (click)="goToPage(i + 1)" [class.active]="currentPage === i + 1">
          {{ i + 1 }}
        </button>

        <button class="pagination-btn" (click)="nextPage()" [disabled]="currentPage === totalPages">
          Next &raquo;
        </button>
      </div>


      <!-- Filtered Hospital Card Grid -->
      <div class="glass-card hospital-list-card" *ngIf="showHospitalfilterData && isClick === true">
        <div class="card-header-custom">
          <i class="fas fa-filter"></i>
          <span>Search Results</span>
        </div>
        <div class="card-body-custom">
          <div class="hospital-grid">
            <div class="hospital-item" *ngFor="let hospital of paginatedHospitals; let i = index"
              [style.animation-delay]="i * 0.1 + 's'">
              <div class="hospital-card">
                <div class="hospital-card-header">
                  <div class="hospital-icon-wrapper">
                    <i class="fas fa-hospital"></i>
                  </div>
                  <h5 class="hospital-name">{{ hospital.name }}</h5>
                </div>

                <div class="hospital-details">
                  <div class="detail-item">
                    <i class="fas fa-map-marker-alt detail-icon"></i>
                    <div class="detail-content">
                      <span class="detail-label">Location</span>
                      <span class="detail-value">{{ hospital.location }}</span>
                    </div>
                  </div>

                  <div class="detail-item">
                    <i class="fas fa-id-badge detail-icon"></i>
                    <div class="detail-content">
                      <span class="detail-label">Hospital ID</span>
                      <span class="detail-value">{{ hospital.id }}</span>
                    </div>
                  </div>
                </div>

                <div class="hospital-actions">
                  <button class="action-btn btn-equipment" (click)="Addequipment(hospital)" data-bs-toggle="modal"
                    data-bs-target="#driverModal">
                    <i class="fas fa-tools"></i>
                    <span>Equipment</span>
                  </button>
                  <button class="action-btn btn-edit" (click)="editHospital(hospital)" data-bs-toggle="modal"
                    data-bs-target="#editHospitalModal">
                    <i class="fas fa-pencil-alt"></i>
                    <span>Edit</span>
                  </button>
                  <button class="action-btn btn-delete" (click)="deleteHospital(hospital.id)">
                    <i class="fas fa-trash-alt"></i>
                    <span>Delete</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Add Hospital Modal -->
  <div class="modal fade" id="addHospitalModal" tabindex="-1" aria-labelledby="addHospitalModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content modal-custom">
        <div class="modal-header-custom">
          <h5 class="modal-title-custom" id="addHospitalModalLabel">
            <i class="fas fa-hospital"></i>
            {{ editingHospitalId ? 'Update Hospital' : 'Add New Hospital' }}
          </h5>
          <button type="button" class="btn-close-custom" data-bs-dismiss="modal" aria-label="Close">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="modal-body-custom">
          <form [formGroup]="itemForm" (ngSubmit)="onSubmit()" class="hospital-form">
            <div class="form-group-custom">
              <label class="form-label-custom">
                <i class="fas fa-hospital"></i>
                Hospital Name
              </label>
              <div class="input-wrapper">
                <input formControlName="name" type="text" class="form-input-custom" placeholder="Enter Hospital Name" />
                <span class="input-border"></span>
              </div>
              <div
                *ngIf="itemForm.get('name')?.invalid && (itemForm.get('name')?.dirty || itemForm.get('name')?.touched)"
                class="error-message">
                <i class="fas fa-exclamation-circle"></i>
                Please enter hospital name
              </div>
            </div>

            <div class="form-group-custom">
              <label class="form-label-custom">
                <i class="fas fa-map-marker-alt"></i>
                Hospital Location
              </label>
              <div class="input-wrapper">
                <input formControlName="location" type="text" class="form-input-custom"
                  placeholder="Enter Hospital Location" />
                <span class="input-border"></span>
              </div>
              <div
                *ngIf="itemForm.get('location')?.invalid && (itemForm.get('location')?.dirty || itemForm.get('location')?.touched)"
                class="error-message">
                <i class="fas fa-exclamation-circle"></i>
                Please enter hospital location
              </div>
            </div>

            <div *ngIf="showMessage" class="alert-custom alert-success">
              <i class="fas fa-check-circle"></i>
              {{ responseMessage }}
            </div>
            <div *ngIf="showError" class="alert-custom alert-error">
              <i class="fas fa-times-circle"></i>
              {{ errorMessage }}
            </div>

            <div class="modal-footer-custom">
              <button type="submit" class="btn-modal-submit" [disabled]="itemForm.invalid">
                <i class="fas fa-save"></i>
                {{ editingHospitalId ? 'Update Hospital' : 'Save Hospital' }}
              </button>
              <button type="button" class="btn-modal-close" data-bs-dismiss="modal">
                <i class="fas fa-times"></i>
                Close
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Assign Equipment Modal -->
  <div class="modal fade" id="driverModal" tabindex="-1" aria-labelledby="driverModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content modal-custom">
        <div class="modal-header-custom">
          <h5 class="modal-title-custom">
            <i class="fas fa-tools"></i>
            Assign Equipment
          </h5>
          <button type="button" class="btn-close-custom" data-bs-dismiss="modal" aria-label="Close">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="modal-body-custom">
          <form [formGroup]="equipmentForm" (ngSubmit)="submitEquipment()" class="equipment-form">
            <input type="hidden" formControlName="hospitalId" />

            <div class="form-group-custom">
              <label class="form-label-custom">
                <i class="fas fa-cog"></i>
                Equipment Name
              </label>
              <div class="input-wrapper">
                <input type="text" class="form-input-custom" formControlName="name"
                  placeholder="Enter Equipment Name" />
                <span class="input-border"></span>
              </div>
              <div
                *ngIf="equipmentForm.get('name')?.invalid && (equipmentForm.get('name')?.dirty || equipmentForm.get('name')?.touched)"
                class="error-message">
                <i class="fas fa-exclamation-circle"></i>
                Please enter equipment name
              </div>
            </div>

            <div class="form-group-custom">
              <label class="form-label-custom">
                <i class="fas fa-align-left"></i>
                Description
              </label>
              <div class="input-wrapper">
                <input type="text" class="form-input-custom" formControlName="description"
                  placeholder="Enter Equipment Description" />
                <span class="input-border"></span>
              </div>
              <div
                *ngIf="equipmentForm.get('description')?.invalid && (equipmentForm.get('description')?.dirty || equipmentForm.get('description')?.touched)"
                class="error-message">
                <i class="fas fa-exclamation-circle"></i>
                Please enter description
              </div>
            </div>

            <div *ngIf="showMessage" class="alert-custom alert-success">
              <i class="fas fa-check-circle"></i>
              {{ responseMessage }}
            </div>
            <div *ngIf="showError" class="alert-custom alert-error">
              <i class="fas fa-times-circle"></i>
              {{ errorMessage }}
            </div>

            <div class="modal-footer-custom">
              <button type="submit" class="btn-modal-submit" [disabled]="equipmentForm.invalid">
                <i class="fas fa-save"></i>
                Save Equipment
              </button>
              <button type="button" class="btn-modal-close" data-bs-dismiss="modal">
                <i class="fas fa-times"></i>
                Close
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Hospital Modal (separate, like Equipment) -->
  <div class="modal fade" id="editHospitalModal" tabindex="-1" aria-labelledby="editHospitalModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content modal-custom">
        <div class="modal-header-custom">
          <h5 class="modal-title-custom" id="editHospitalModalLabel">
            <i class="fas fa-pencil-alt"></i>
            Edit Hospital
          </h5>
          <button type="button" class="btn-close-custom" data-bs-dismiss="modal" aria-label="Close">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body-custom">
          <form [formGroup]="itemForm" (ngSubmit)="onSubmit()" class="hospital-form">
            <div class="form-group-custom">
              <label class="form-label-custom">
                <i class="fas fa-hospital"></i>
                Hospital Name
              </label>
              <div class="input-wrapper">
                <input formControlName="name" type="text" class="form-input-custom" placeholder="Enter Hospital Name" />
                <span class="input-border"></span>
              </div>
              <div
                *ngIf="itemForm.get('name')?.invalid && (itemForm.get('name')?.dirty || itemForm.get('name')?.touched)"
                class="error-message">
                <i class="fas fa-exclamation-circle"></i>
                Please enter hospital name
              </div>
            </div>

            <div class="form-group-custom">
              <label class="form-label-custom">
                <i class="fas fa-map-marker-alt"></i>
                Hospital Location
              </label>
              <div class="input-wrapper">
                <input formControlName="location" type="text" class="form-input-custom"
                  placeholder="Enter Hospital Location" />
                <span class="input-border"></span>
              </div>
              <div
                *ngIf="itemForm.get('location')?.invalid && (itemForm.get('location')?.dirty || itemForm.get('location')?.touched)"
                class="error-message">
                <i class="fas fa-exclamation-circle"></i>
                Please enter hospital location
              </div>
            </div>

            <div *ngIf="showMessage" class="alert-custom alert-success">
              <i class="fas fa-check-circle"></i>
              {{ responseMessage }}
            </div>
            <div *ngIf="showError" class="alert-custom alert-error">
              <i class="fas fa-times-circle"></i>
              {{ errorMessage }}
            </div>

            <div class="modal-footer-custom">
              <button type="submit" class="btn-modal-submit" [disabled]="itemForm.invalid">
                <i class="fas fa-save"></i>
                Update Hospital
              </button>
              <button type="button" class="btn-modal-close" data-bs-dismiss="modal">
                <i class="fas fa-times"></i>
                Close
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>