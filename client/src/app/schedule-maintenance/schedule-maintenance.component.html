<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MediSphere: Hospital- Schedule Maintenance</title>
</head>
<body>
  
<!-- Schedule Maintenance Header -->
<div class="text-center mb-4 " id="space">
  <h2 class="fw-bold">Schedule Maintenance </h2>
</div>

<!-- Schedule Maintenance Form -->
<div class="container mt-4">
  <div class="card shadow">
    <div class="card-header text-center fw-bold">
      Schedule Maintenance of Equipment
    </div>
    <div class="card-body">
      <form [formGroup]="itemForm" (ngSubmit)="onSubmit()" class="animate__animated animate__fadeIn">

        <div class="row">
          <!-- Left Side -->
          <div class="col-md-6">
            <!-- Hospital Dropdown -->
            <div class="mb-3">
              <label class="form-label fw-bold">Hospital</label>
              <select class="form-control" formControlName="hospitalId" (change)="onHospitalSelect($event)">
                <option value="null">Please Choose</option>
                <option *ngFor="let hos of hospitalList" [value]="hos.id">{{ hos.name }}</option>
              </select>
              <div *ngIf="itemForm.controls['hospitalId'].invalid && (itemForm.controls['hospitalId'].dirty || itemForm.controls['hospitalId'].touched)"
                class="text-danger mt-1">
                Please choose a hospital.
              </div>
            </div>

            <!-- Equipment Dropdown -->
            <div class="mb-3">
              <label class="form-label fw-bold">Equipment</label>
              <select class="form-control" formControlName="equipmentId">
                <option value="null">Please Choose</option>
                <option *ngFor="let eq of equipmentList" [value]="eq.id">{{ eq.name }}</option>
              </select>
              <div *ngIf="itemForm.controls['equipmentId'].invalid && (itemForm.controls['equipmentId'].dirty || itemForm.controls['equipmentId'].touched)"
                class="text-danger mt-1">
                Please choose equipment.
              </div>
            </div>
          </div>

          <!-- Right Side -->
          <div class="col-md-6">
            <div class="row">
              <!-- Scheduled Date -->
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label fw-bold">Scheduled Date</label>
                  <input type="date" class="form-control" formControlName="scheduledDate" />
                  <div *ngIf="itemForm.controls['scheduledDate'].invalid && (itemForm.controls['scheduledDate'].dirty || itemForm.controls['scheduledDate'].touched)"
                    class="text-danger mt-1">
                    Please enter a valid scheduled date.
                  </div>
                </div>
              </div>

              <!-- Deadline -->
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label fw-bold">Deadline</label>
                  <input type="date" class="form-control" formControlName="completedDate" />
                  <div *ngIf="itemForm.controls['completedDate'].invalid && (itemForm.controls['completedDate'].dirty || itemForm.controls['completedDate'].touched)"
                    class="text-danger mt-1">
                    Please enter a valid deadline.
                  </div>
                </div>
              </div>
            </div>

            <!-- Custom Date Validation -->
            <div *ngIf="itemForm.errors?.['invalidDateRangeCheck'] && (itemForm.get('scheduledDate')?.touched || itemForm.get('completedDate')?.touched)"
              class="text-danger fw-bold mb-3">
              Schedule Date must be earlier than Deadline.
            </div>

            <!-- Description -->
            <div class="mb-3">
              <label class="form-label fw-bold">Description</label>
              <input type="text" class="form-control" formControlName="description" placeholder="Description" />
              <div *ngIf="itemForm.controls['description'].invalid && (itemForm.controls['description'].dirty || itemForm.controls['description'].touched)"
                class="text-danger mt-1">
                Please enter description.
              </div>
            </div>

            <!-- Status -->
            <!-- <div class="mb-3">
              <label class="form-label fw-bold">Status</label>
              <select class="form-control" formControlName="status">
                <option value="">Choose Status</option>
                <option value="Initiated">Initiated</option>
              </select>
              <div *ngIf="itemForm.controls['status'].invalid && (itemForm.controls['status'].dirty || itemForm.controls['status'].touched)"
                class="text-danger mt-1">
                Please choose a status.
              </div>
            </div> -->

            <!-- Buttons -->
            <div class="d-grid gap-2">
              <button class="btn btn-primary" type="submit" [disabled]="itemForm.invalid">Submit</button>
              <button class="btn btn-secondary" type="button" (click)="showSatus()">Show Status</button>
            </div>

            <!-- Success Message -->
            <div *ngIf="showMessage" class="alert alert-success mt-3">
              {{ responseMessage }}
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Maintenance Records Table -->
<div *ngIf="isClick" class="container mt-5">
  <div class="card shadow">
    <div class="card-header fw-bold">Maintenance Information</div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-bordered align-middle">
          <thead class="bg-dark text-white">
            <tr>
              <th>Maintenance ID</th>
              <th>Scheduled Date</th>
              <th>Deadline</th>
              <th>Status</th>
              <th>Equipment</th>
              <th>Hospital</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let m of maintenanceList">
              <td>{{ m.id }}</td>
              <td>{{ m.scheduledDate | date : "dd-MMM-yyyy" }}</td>
              <td>{{ m.completedDate | date : "dd-MMM-yyyy" }}</td>
              <td [ngStyle]="getStatusStyle(m.status)">
                <strong>{{ m.status }}</strong>
              </td>
              <td>
                <p><strong>ID:</strong> {{ m.equipment.id }}</p>
                <p><strong>Name:</strong> {{ m.equipment.name }}</p>
                <p><strong>Description:</strong> {{ m.equipment.description }}</p>
              </td>
              <td>
                <p><strong>ID:</strong> {{ m.equipment.hospital.id }}</p>
                <p><strong>Name:</strong> {{ m.equipment.hospital.name }}</p>
                <p><strong>Location:</strong> {{ m.equipment.hospital.location }}</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

</body>
</html>
